<div class="widget">
	<div class="header">
		<span ><span class="ico  gray random"></span>Table Student</span>
	</div>
	<div class="content"  >
		<div align="center">
			<%=form_tag @data_student_path, :method=>'get' do%>
			<p>
				<%= label_tag :search,"Enter Student No:"%>
				<br/>
				<%= text_field_tag :search,params[:search]%>
				<%= hidden_field :act,:value => "searching"%>
				<%= submit_tag "Search",:name=>nil%>
			</p>
			<%end%>
		</div>
		<%unless params[:search].nil?%>
		<%if @data_student.empty?%>
		<%#flash[:error]="Tiada carian yang berpadanan..."%>
		Tiada carian yang berpadanan...
		<%else%>
		<%@data_student.each do|f|%>
		<%unless f.user.user_companies.where(:action_status_id=>3).present? %>
		<%#flash[:error]="This user is not register under a company..."%>
		This user is not register under a company...
		<%else%>
		<form>
			<table>
				<%@data_student.each do|f|%>
				<tr>
					<td><b>Matric No:</b></td><td><%= f.matric_no%></td>
				</tr>
				<tr>
					<td><b>Name:</b></td><td><%= f.user.name%></td>
				</tr>
				<tr>
					<td><b>Company For Internships:</b></td>
					<td><b><%= f.user.user_companies.where(:action_status_id=>3).first.company.user.name%></b>
					<br/>
					<%= f.user.user_companies.where(:action_status_id=>3).first.company.user.comp_profiles.first.place%>
					<br/>
					<%= f.user.user_companies.where(:action_status_id=>3).first.company.user.comp_profiles.first.postcode%>
					<br/>
					<%= f.user.user_companies.where(:action_status_id=>3).first.company.user.comp_profiles.first.city%>
					<br/>
					<%unless f.user.user_companies.where(:action_status_id=>3).first.company.user.comp_profiles.first.state_id.nil?%>
					<%= f.user.user_companies.where(:action_status_id=>3).first.company.user.comp_profiles.first.state.name%><%end%>
					<br/>
					</td>
				</tr>
				<tr>
					<td><b>Academic Supervisor:</b></td><td><%if f.staff_id? %><%= f.staff.name%><%end%></td>
				</tr>
				<%end%>
			
				<tr>
					<fieldset>
						<legend>
							Action
						</legend>
						<form>
							<div class="field">
								<label>Academic Supervisor :</label>
								<input type="hidden" id="studid" value= '<%=@data_student[0].matric_no%>'/>
								<%= collection_select(:stud_profile,:staff_id,Staff.where(:staff_type_id=>3).all,:id,:name,:prompt=>"Please Select") %>
								<input type="button" value="Update Student Profile" id="updatesv"/>
							</div>
						</form>
					</fieldset>
				</tr>
			</table>
		</form>
			<%end%>
			<%end%>
			<%end%>
			<%end%>
			<form>
				<div class="tableName">
					<table class="display data_table2" >
						<thead>
							<tr>
							    <th width="40" align="left">
								<div class="th_wrapp">
									No
								</div></th>
								<th width="80" align="center">
								<div class="th_wrapp">
									Matric No
								</div></th>
								<th width="174" >
								<div class="th_wrapp">
									Name
								</div></th>
								<th width="174" >
								<div class="th_wrapp">
									Company
								</div></th>
								<th width="174" >
								<div class="th_wrapp">
									State
								</div></th>
								<th width="246" >
								<div class="th_wrapp">
									Academic Supervisor
								</div></th>
							</tr>
						</thead>
						<tbody>
						
							<% @i=0%>

							<%@stud.each do|f|%>
							<% @i+=1%>
							<tr>
								<td><%=@i%>)</td>

								<td><%=form_tag @data_student_path, :method=>'get' do%>
								<%= hidden_field_tag :search,params[:search],:value=>StudProfile.find(:all,:conditions=>["user_id=?",f.user_id]).first.matric_no%>
								<%= submit_tag "",:class => 'uibutton loading',:value=>StudProfile.find(:all,:conditions=>["user_id=?",f.user_id]).first.matric_no,:name=>nil %>
								<%end%></td>
								<td><%=f.user.name %></td>
								<td>
										
										 <%= UserCompany.find(:first,:conditions=>["company_id=? and  action_status_id=?",f.company_id,3]).company.name%>
										<%#end%>
									
								</td>
								<td>
									<%#unless f.user.user_companies.exists? == false%>
										<%#unless f.user.user_companies.where(:action_status_id=>3).exists? == false%>
										 <%= f.action_status.name%>
										
								</td>								
								<td>
								<%if !StudProfile.find_by_user_id(f.user_id).staff_id.nil? %> 
								<%= StudProfile.find_by_user_id(f.user_id).staff.name %>
								<%end%>
								</td>
							</tr>
							<%end%>
						</tbody>
					</table>
				</div>
	</div>
	</form>
</div>
<script type="text/javascript">
	
	$(document).ready(function () {
		$("#updatesv").click(function (){
			$.ajax({
				type: "GET",
				url: "updatestudprof",
				data: { 
					studid: $("#studid").val(),
					staffid: $("#stud_profile_staff_id").val()
				}
			}).success(function( t ) {	
				//alert("success");
				window.location.reload();
			});
		});
	});
</script>